[tasks.packages]
description = "Provision System packages (Apt, Flatpak)"
usage = '''
flag "-u --update"          help="Update packages"
arg "[bundle]" var=#true    help="Specifies which software bundles to provision" default="base"
'''
run = 'exec mise run --jobs=1 packages:?* ${usage_update:+--update} ${usage_bundle}'

[tasks."packages:apt"]
description = "Provision Apt packages"
usage = '''
flag "-u --update"          help="Update packages"
arg "[bundle]" var=#true    help="Specifies which software bundles to provision" default="base"
'''
run = './nu/install-packages.nu apt ${usage_update:+--update} ${usage_bundle}'

[tasks."packages:flatpak"]
description = "Provision Flatpak packages"
usage = '''
flag "-u --update"          help="Update packages"
arg "[bundle]" var=#true    help="Specifies which software bundles to provision" default="base"
'''
run = './nu/install-packages.nu flatpak ${usage_update:+--update} ${usage_bundle}'

[tasks."nix:list"]
description = "List nix profiles"
run="nix profile list"

[tasks.nix]
description = "Provision (install/update) Nix packages"
usage='''
arg "profile"                                   help="Specify which nix profile to (profiles under nix/*)"
flag "-u --update"                              help="Update nix profile (forces update even if flake.nix changes are not tracked)"
flag "-o --output <output>" default="default"   help="Specify flake package output (see the corresponding flake.nix aka desktop/cloud etc)"
'''
run='./nu/install-packages.nu nix ${usage_update:+--update} --output=${usage_output} ${usage_profile}'
